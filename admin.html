<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ici.c'est.PARIS | Administration Sécurisée</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        .admin-auth-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--paris-blue);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .auth-card {
            background: white;
            padding: 40px;
            border-radius: 12px;
            text-align: center;
            max-width: 400px;
            width: 90%;
        }

        .auth-card h2 {
            font-family: var(--font-heading);
            margin-bottom: 20px;
        }

        .auth-card input {
            width: 100%;
            padding: 15px;
            margin-bottom: 20px;
            border: 1px solid #ddd;
        }

        .admin-container {
            padding: 40px;
            max-width: 1200px;
            margin: 0 auto;
            display: none;
        }

        .product-manager {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 40px;
        }

        .current-products {
            height: 600px;
            overflow-y: auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #eee;
        }

        .p-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            border-bottom: 1px solid #eee;
            align-items: center;
        }

        .p-item:hover {
            background: #f9f9f9;
        }

        .delete-btn {
            color: red;
            cursor: pointer;
            font-weight: bold;
        }

        .discount-badge {
            background: var(--paris-red);
            color: white;
            padding: 2px 5px;
            border-radius: 3px;
            font-size: 10px;
        }
    </style>
</head>

<body>

    <!-- Simple Password Protection -->
    <div id="auth-overlay" class="admin-auth-overlay">
        <div class="auth-card">
            <h2>Accès Admin</h2>
            <input type="password" id="admin-pass" placeholder="Mot de passe">
            <button class="icon-btn" onclick="checkAuth()">Se Connecter</button>
            <p id="auth-error" style="color:red; margin-top:10px; display:none;">Accès refusé.</p>
        </div>
    </div>

    <div id="admin-content" class="admin-container">
        <header style="display:flex; justify-content:space-between; align-items:center; margin-bottom:40px;">
            <h1 style="font-family: var(--font-heading); color: var(--paris-blue);">Gestion ici.c'est.PARIS</h1>
            <button class="icon-btn" style="background:var(--paris-red)"
                onclick="location.reload()">Déconnexion</button>
        </header>

        <div class="product-manager">
            <!-- Add Form -->
            <div class="admin-page" style="margin:0; width:100%;">
                <h3>Ajouter un Produit</h3>
                <br>
                <div class="admin-form">
                    <input type="text" id="p-name" placeholder="Nom du Produit">
                    <select id="p-category">
                        <option value="Homme">Homme</option>
                        <option value="Chaussures">Chaussures</option>
                        <option value="Accessoires">Accessoires</option>
                        <option value="Nouveautés">Nouveautés</option>
                    </select>
                    <input type="number" id="p-price" placeholder="Prix (ex: 38500)">
                    <input type="number" id="p-old-price" placeholder="Prix Original (facultatif)">
                    <input type="text" id="p-image" placeholder="Image URL ou nom (ex: nike.jpg)">
                    <button class="admin-btn" onclick="saveToFirebase()">Publier sur le Site</button>
                </div>
            </div>

            <!-- List View -->
            <div class="current-products">
                <h3>Produits en Ligne</h3>
                <br>
                <div id="p-list-sync">
                    <!-- Products from Firebase -->
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        // --- ADMIN LOGIN LOGIC ---
        function checkAuth() {
            const pass = document.getElementById('admin-pass').value;
            if (pass === "paris2026") { // Temporary easy password
                document.getElementById('auth-overlay').style.display = 'none';
                document.getElementById('admin-content').style.display = 'block';
                loadFirebaseData();
            } else {
                document.getElementById('auth-error').style.display = 'block';
            }
        }

        // --- FIREBASE ADMIN OPS ---
        function saveToFirebase() {
            const name = document.getElementById('p-name').value;
            const cat = document.getElementById('p-category').value;
            const price = parseInt(document.getElementById('p-price').value);
            const oldPrice = parseInt(document.getElementById('p-old-price').value) || null;
            const img = document.getElementById('p-image').value;

            if (!name || !price || !img) return alert("Veuillez remplir les champs obligatoires.");

            const newProductRef = database.ref('products').push();
            newProductRef.set({
                id: Date.now(),
                name: name,
                category: cat,
                price: price,
                oldPrice: oldPrice,
                displayPrice: price.toLocaleString() + " DA",
                image: img
            }).then(() => {
                alert("Produit ajouté avec succès !");
                document.querySelectorAll('.admin-form input').forEach(i => i.value = '');
            });
        }

        function loadFirebaseData() {
            database.ref('products').on('value', (snapshot) => {
                const data = snapshot.val();
                const list = document.getElementById('p-list-sync');
                list.innerHTML = '';
                if (data) {
                    Object.keys(data).forEach(key => {
                        const p = data[key];
                        list.innerHTML += `
                            <div class="p-item">
                                <div>
                                    <b>${p.name}</b><br>
                                    <small>${p.displayPrice} ${p.oldPrice ? '<span class="discount-badge">Promotion</span>' : ''}</small>
                                </div>
                                <span class="delete-btn" onclick="deleteProduct('${key}')">❌ Effacer</span>
                            </div>
                        `;
                    });
                }
            });
        }

        function deleteProduct(key) {
            if (confirm("Supprimer ce produit définitivement ?")) {
                database.ref('products/' + key).remove();
            }
        }
    </script>
</body>

</html>