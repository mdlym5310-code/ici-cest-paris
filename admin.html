<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <title>Administration ici.c'est.PARIS</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .admin-wrap {
            max-width: 800px;
            margin: 50px auto;
            padding: 40px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            border-top: 5px solid var(--paris-blue);
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-weight: 800;
            margin-bottom: 8px;
            color: var(--paris-blue);
        }

        input,
        select {
            width: 100%;
            padding: 12px;
            border: 2px solid #EEE;
            border-radius: 10px;
            font-family: inherit;
        }

        .actions {
            display: flex;
            gap: 10px;
        }

        .btn-add {
            background: var(--paris-blue);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 900;
        }

        .btn-add:hover {
            background: var(--paris-red);
        }

        #auth-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--paris-blue);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #auth-modal {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
        }
    </style>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
</head>

<body>
    <div id="auth-screen">
        <div id="auth-modal">
            <h2 style="margin-bottom: 20px;">Accès Boutique Officielle</h2>
            <input type="password" id="admin-pass" placeholder="Mot de passe">
            <button class="btn-add" style="margin-top: 15px;" onclick="checkAuth()">ENTRER</button>
        </div>
    </div>

    <div class="admin-wrap" id="admin-interface" style="display:none;">
        <h1 style="color:var(--paris-blue); margin-bottom: 30px;">Gestion ici.c'est.PARIS</h1>

        <div class="form-group">
            <label>Nom du Produit</label>
            <input type="text" id="p-name" placeholder="ex: Ensemble Nike Tech Green">
        </div>
        <div class="form-group">
            <label>Catégorie</label>
            <select id="p-cat">
                <option value="Homme">Homme</option>
                <option value="Femme">Femme</option>
                <option value="Chaussures">Chaussures</option>
                <option value="Accessoires">Accessoires</option>
            </select>
        </div>
        <div class="form-group">
            <label>Taille(s) disponibles (séparées par des virgules)</label>
            <input type="text" id="p-sizes" placeholder="ex: S, M, L, XL ou 40, 41, 42">
        </div>
        <div class="form-group marathon-row" style="display:flex; gap:15px;">
            <div style="flex:1">
                <label>Prix (DA)</label>
                <input type="number" id="p-price" placeholder="38500">
            </div>
            <div style="flex:1">
                <label>Statut</label>
                <select id="p-stock">
                    <option value="in">En Stock</option>
                    <option value="out">Rupture</option>
                </select>
            </div>
        </div>
        <div class="form-group">
            <label>URL de l'image (Instagram ou Direct)</label>
            <input type="text" id="p-img" placeholder="https://...">
        </div>

        <button class="btn-add" onclick="addProduct()">PUBLIER SUR LA BOUTIQUE</button>

        <hr style="margin: 40px 0; border: 1px solid #EEE;">
        <h3>Aperçu du Flux Direct</h3>
        <p style="font-size: 13px; color: #666;">Les modifications apparaîtront instantanément sur le site dès que
            Firebase sera configuré.</p>
    </div>

    <script>
        /**
         * Firebase Configuration for Admin Panel
         * 
         * IMPORTANT: Replace these placeholder values with your actual Firebase credentials
         * Get them from: Firebase Console > Project Settings > General > Your apps
         * 
         * Security Rules Required (Firebase Console > Realtime Database > Rules):
         * {
         *   "rules": {
         *     "products": {
         *       ".read": true,
         *       ".write": "auth != null || root.child('admin').child('enabled').val() == true"
         *     }
         *   }
         * }
         */
        const firebaseConfig = {
            apiKey: "AIzaSyAs-EXAMPLE-PLACEHOLDER",
            authDomain: "ici-cest-paris-store.firebaseapp.com",
            databaseURL: "https://ici-cest-paris-store-default-rtdb.firebaseio.com",
            projectId: "ici-cest-paris-store",
            storageBucket: "ici-cest-paris-store.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:abcdef"
        };
        
        let database;
        try {
            firebase.initializeApp(firebaseConfig);
            database = firebase.database();
            console.log("✅ Firebase Admin initialized successfully");
        } catch (error) {
            console.error("❌ Firebase initialization error:", error);
            alert("⚠️ Erreur d'initialisation Firebase. Vérifiez votre configuration.");
        }

        function checkAuth() {
            if (document.getElementById('admin-pass').value === 'paris2026') {
                document.getElementById('auth-screen').style.display = 'none';
                document.getElementById('admin-interface').style.display = 'block';
            } else { alert("Mot de passe incorrect !"); }
        }

        function addProduct() {
            // Validate inputs
            const name = document.getElementById('p-name').value.trim();
            const price = document.getElementById('p-price').value.trim();
            const image = document.getElementById('p-img').value.trim();
            const sizes = document.getElementById('p-sizes').value.trim();
            
            if (!name || !price || !image) {
                alert("⚠️ Veuillez remplir tous les champs obligatoires (Nom, Prix, Image)");
                return;
            }
            
            if (!database) {
                alert("❌ Firebase n'est pas configuré. Veuillez configurer Firebase pour enregistrer en ligne.");
                return;
            }
            
            const id = Date.now();
            const product = {
                id: id,
                name: name,
                category: document.getElementById('p-cat').value,
                price: parseInt(price),
                displayPrice: price + " DA",
                image: image,
                sizes: sizes ? sizes.split(',').map(s => s.trim()).filter(s => s) : ["Standard"],
                stock: document.getElementById('p-stock').value,
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };

            // Show loading state
            const btn = document.querySelector('.btn-add');
            const originalText = btn.textContent;
            btn.textContent = "Publication en cours...";
            btn.disabled = true;

            database.ref('products/' + id).set(product)
                .then(() => {
                    alert("✅ Produit ajouté avec succès !");
                    // Reset form
                    document.getElementById('p-name').value = '';
                    document.getElementById('p-price').value = '';
                    document.getElementById('p-img').value = '';
                    document.getElementById('p-sizes').value = '';
                    btn.textContent = originalText;
                    btn.disabled = false;
                })
                .catch(e => {
                    console.error("Firebase error:", e);
                    alert("❌ Erreur lors de l'ajout: " + e.message);
                    btn.textContent = originalText;
                    btn.disabled = false;
                });
        }
        
        // Add real-time product preview
        if (database) {
            database.ref('products').on('value', (snapshot) => {
                const products = snapshot.val();
                const count = products ? Object.keys(products).length : 0;
                const previewText = document.querySelector('.admin-wrap h3 + p');
                if (previewText) {
                    previewText.textContent = `Les modifications apparaîtront instantanément sur le site. ${count} produit(s) actuellement en ligne.`;
                }
            });
        }
    </script>
</body>

</html>